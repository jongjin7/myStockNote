# 주식 노트 웹앱 PRD (MVP v2.0)

## 1. 개요 (Overview)

본 문서는 개인 투자자가 여러 증권사에 분산된 주식 자산과 예수금을 **수동으로 기록·관리**하고, 종목별 투자 판단과 회고를 체계적으로 남길 수 있도록 돕는 **개인용 주식 노트 웹앱**의 MVP(Minimum Viable Product) 요구사항을 정의한다.

이 앱의 핵심 가치는 수익률이나 실시간 시세가 아니라, **투자 판단의 기록과 복기를 통해 더 나은 의사결정을 돕는 것**에 있다.

이 제품은 거래를 수행하는 시스템이 아니라, 투자 활동을 **정리·관리·복기**하기 위한 도구이며, 자동 계좌 연동이나 실시간 시세 제공은 범위에 포함하지 않는다.

---

## 2. 사용자 페르소나

* 역할: 주린이
* 투자 성향: 국내 주식(AI ETF, 반도체), 미국 주식(개별 종목, 배당주 중심의 성장주 중심)
* 계좌 현황: 한국투자증권, 유안타증권, 카카오증권 등 복수 증권사 이용
* 니즈:
  * 증권사별 자산을 한 화면에서 정리하고 싶음
  * 매수 이유와 투자 판단을 기록하고 싶음
  * 엑셀이나 메모앱보다 구조화된 관리 도구를 원함

### 사용 시나리오

* **사용 시점**: 평일 장 종료 후, 주말 자산 정리 시간, 매수 또는 매도 직후
* **주요 행동**:
  * 현재 포지션과 계좌별 자산 상태를 빠르게 확인
  * 방금 매수/매도한 종목에 대한 판단과 감정을 즉시 기록
  * 이전 투자 판단을 다시 읽으며 스스로의 결정을 복기
* **사용을 방해하는 요인**:
  * 입력 과정이 번거롭거나 시간이 많이 걸리는 경우
  * 단순 조회용 정보만 제공되어 기록할 이유가 없는 경우
  * HTS/MTS와 차별점이 느껴지지 않는 경우

---

## 3. 문제 정의 (Problem Statement)

* 증권사마다 앱/HTS가 분리되어 있어 전체 자산 상태를 직관적으로 파악하기 어려움
* 투자 판단(매수 이유, 기대, 실수)에 대한 기록이 흩어져 있거나 남아 있지 않음
* 시간이 지나면 왜 이 종목을 샀는지, 왜 팔았는지 스스로 설명하기 어려워짐

### 문제 정의 압축

> **개인 투자자는 언제든지 자신의 주식 종목을 관리하고 싶지만, 자산은 흩어져 있고 투자 판단은 기록되지 않아 스스로의 결정을 지속적으로 관리·복기하기 어렵다.**

---

## 4. 제품 목표 (Goals)

* 여러 증권사 계좌의 예수금과 보유 종목을 논리적으로 통합 관리
* 종목별 투자 판단과 히스토리를 기록할 수 있는 구조 제공
* 개인이 지속적으로 사용할 수 있는 단순하고 안정적인 웹앱 구현

---

## 5. 핵심 기능 (MVP Scope)

### 5.1 증권사 / 계좌 관리

* 증권사 이름을 기준으로 계좌 생성 (메타 정보 활용)
* 계좌별 예수금을 수동 관리 (`Account` 테이블 내 관리)
* **제약:** 계좌명 최대 50자, 계좌 최대 20개. **모든 통화는 KRW(원화)를 기준으로 함.**

### 5.2 예수금 관리 정책

* 사용자가 직접 입력 (매매 연동 자동 차감 없음)
* 계좌별 예수금을 `Account` 테이블 내 `cash_balance` 필드로 관리
* 전체 예수금 자동 합산 표시 및 업데이트 시각 기록
* **입력 제약:** 음수 불가, 최대 999조 원 (정수 입력)

### 5.3 종목 관리 및 로직

#### 5.3.1 기본 정책

* **수량/단가:** 국내 주식 시장 환경에 맞춰 **정수(Integer)** 입력을 원칙으로 함.
* **통화:** 별도 구분 없이 모든 금액은 **KRW**로 처리.

#### 5.3.2 상태 관리

* **상태:** `WATCHLIST`(관심) / `HOLDING`(보유) / `PARTIAL_SOLD`(일부매도) / `SOLD`(전량매도)
* **상태 전환 규칙 (자동화):**
  * **매수 추가:** 기존 종목 존재 시 수량/평단가 갱신(가중평균), 없으면 신규 생성.
  * **매도 기록:** 매도 수량 입력 → 보유 수량 차감.
    * 남은 수량 > 0: `HOLDING` (또는 `PARTIAL_SOLD`) 유지.
    * 남은 수량 = 0: `SOLD`로 **자동 상태 변경**.

#### 5.3.3 관심 종목 → 보유 종목 전환 (Conversion Flow)

**[핵심 UX]**

* **진입점:**
  * Mobile: 상세 화면 하단 고정 바 `[이 종목 매수 확정하기]`
  * PC: 좌측 정보 패널 하단 `[보유 종목으로 전환]`

* **전환 모달 (Context Bridge):**
  1. **필수 정보 입력:** 계좌 선택, 매수 수량(정수), 매수 단가(정수) 입력.
  2. **맥락 연결 (Research to Action):**
     * 조건: 해당 종목에 작성된 리서치(`GENERAL`) 노트가 있을 경우 노출.
     * UI: `☑️ 최근 리서치 기록을 매수 이유로 가져오기` 체크박스 제공.
     * 동작: 체크 시, 가장 최근 리서치 노트의 내용을 신규 매수 노트(`PURCHASE`)의 `buy_reason` 필드로 자동 복사.
  3. **완료 처리:**
     * 상태가 `WATCHLIST` → `HOLDING`으로 변경.
     * 보유 종목 상세 화면으로 즉시 전환.

### 5.4 종목별 투자 노트 (핵심 기능)

* **타입:** 매수(PURCHASE) / 매도(SELL) / 일반(GENERAL)
* **작성 트리거:** 종목 신규 추가 시, 매도 직후, 단순 기록 시, 관심 종목 리서치 시.
* **UX 원칙:** 사용자의 자발적 기록을 유도하되, 강제하지 않음 (선택적 제안).

### 5.5 첨부 파일(이미지) 관리

* **저장 방식:** Supabase Storage (Cloud) 업로드 → Public URL을 DB에 저장.
* **업로드 시점:**
  * 작성 중: 브라우저 메모리(Preview)에만 존재.
  * **[저장] 버튼 클릭 시:** 스토리지 업로드 수행 → 성공 시 DB 저장 (불필요한 쓰레기 파일 방지).
* **제약:** 파일당 5MB 제한 (서버 정책 준수).

---

## 6. 대시보드

### 목적 정의

대시보드는 자산을 요약해서 보여주는 화면이 아니라, **사용자가 언제든지 자신의 주식 포지션을 빠르게 인식하고 다음 행동(관리·기록·회고)으로 이어지게 하는 진입 화면**이다.

### 제공 정보

* **전체 예수금 요약**
  - 모든 계좌의 예수금 합계
  - 마지막 업데이트 시각

* **계좌별 예수금 분포**
  - 증권사명, 예수금, 업데이트 시각
  - 계좌 클릭 시 해당 계좌의 종목 필터링

* **보유 종목 리스트 (상태 중심)**
  - 종목명, 수량, 평균단가, 상태
  - 노트 작성 여부 표시 (아이콘 또는 배지)
  - 종목 클릭 시 상세 화면 이동

* **최근 작성한 투자 노트 요약**
  - 최근 3개의 노트 미리보기
  - "더보기" 링크

### 6.1 UX 원칙

* 숫자를 많이 보여주기보다 "지금 관리가 필요한 종목이 무엇인지"가 보이도록 설계
* 대시보드에서 바로 종목 상세 또는 투자 노트 작성으로 이동 가능
* 노트가 없는 종목을 시각적으로 강조 (예: 회색 배경, "노트 작성하기" 버튼)

※ 그래프/차트는 선택 사항이며, MVP에서는 표 중심 UI로 구현

---

## 7. 화면 구조 및 플로우

```
주요 화면 구조
├── 대시보드 (/)
│   ├── 전체 예수금
│   ├── 계좌별 요약
│   ├── 보유 종목 리스트 → [종목 상세 클릭]
│   └── 관심 종목 섹션 → [정찰 종목 보기]
│
├── 계좌 관리 (/accounts)
│   ├── 계좌 목록
│   ├── [계좌 추가] 버튼 → 계좌 추가 모달
│   └── [계좌 수정/삭제] → 계좌 편집 모달
│
├── 관심 종목 (/watchlist)
│   ├── 정찰 중인 종목 리스트
│   ├── [종목 추가] 버튼
│   └── 종목 클릭 → 종목 상세
│
├── 종목 상세 (/stocks/:id)
│   ├── 종목 정보 (종목명, 코드, 수량, 평균단가, 상태)
│   ├── [종목 정보 수정] 버튼
│   ├── 투자 노트 리스트 (시간순)
│   │   └── 각 노트의 첨부 파일 썸네일 표시
│   └── [노트 작성] 버튼 → 노트 작성 화면
│
├── 노트 작성/수정 (/stocks/:id/memos/new 또는 /memos/:memoId/edit)
│   ├── 노트 타입 선택 (매수/매도/일반)
│   ├── 구조화된 입력 필드
│   ├── 파일 첨부 영역 (드래그 앤 드롭)
│   │   ├── 이미지 업로드
│   │   └── 첨부된 파일 목록 (삭제 가능)
│   └── [저장] / [취소] 버튼
│
└── 이미지 뷰어 (모달)
    └── 첨부 이미지 확대 보기
```

**주요 사용자 플로우:**

1. **종목 추가 플로우**
   - 대시보드 → [종목 추가] → 종목 타입 선택 (보유/관심) → 종목 정보 입력 → 저장 → 종목 상세 → "노트 작성 제안" 표시

2. **노트 작성 플로우**
   - 종목 상세 → [노트 작성] → 필드 작성 → 이미지 드래그 앤 드롭 → 저장 → 종목 상세로 복귀

3. **회고 플로우**
   - 대시보드 → 종목 클릭 → 과거 노트 조회 → 첨부된 분석 자료 확인 → 현재 생각과 비교

4. **정찰 종목 → 매수 전환 플로우**
   - 관심 종목 → 종목 클릭 → [매수로 전환] 버튼 → 계좌/수량/단가 입력 → HOLDING으로 상태 변경

---

## 8. 데이터 모델 (상세)

### Account (계좌)
```typescript
{
  id: string (UUID)
  brokerName: string (증권사명, 최대 50자)
  cashBalance: number (예수금, 0 ~ 999,999,999,999)
  memo: string | null (메모, 최대 200자)
  createdAt: timestamp
  updatedAt: timestamp
}
```

### Stock (종목)
```typescript
{
  id: string (UUID)
  accountId: string | null (FK → Account.id, WATCHLIST인 경우 null 가능)
  symbol: string | null (종목코드, 6자리)
  name: string (종목명, 최대 50자)
  quantity: number (수량, 0 ~ 999,999, WATCHLIST인 경우 0)
  avgPrice: number (평균단가, 0 ~ 999,999,999, WATCHLIST인 경우 0)
  status: enum ('WATCHLIST' | 'HOLDING' | 'PARTIAL_SOLD' | 'SOLD')
  createdAt: timestamp
  updatedAt: timestamp
}
```

### StockMemo (투자 노트)
```typescript
{
  id: string (UUID)
  stockId: string (FK → Stock.id)
  type: enum ('PURCHASE' | 'SELL' | 'GENERAL')
  buyReason: string | null (최대 500자)
  expectedScenario: string | null (최대 500자)
  risks: string | null (최대 500자)
  currentThought: string | null (최대 500자)
  sellReview: string | null (최대 500자)
  createdAt: timestamp
  updatedAt: timestamp
}
```

### Attachment (첨부 파일)
```typescript
{
  id: string (UUID)
  memoId: string (FK → StockMemo.id)
  type: enum ('IMAGE' | 'TEXT')
  fileName: string (원본 파일명, 최대 255자)
  fileSize: number (바이트, 최대 5MB)
  mimeType: string (예: 'image/jpeg', 'image/png')
  data: string (Base64 인코딩된 이미지 또는 텍스트 내용)
  createdAt: timestamp
}
```

**관계:**
- Account 1 : N Stock
- Stock 1 : N StockMemo
- StockMemo 1 : N Attachment

---

## 9. 기술적 범위

### 플랫폼
- Web App (반응형 디자인, 모바일 최적화)

### 프론트엔드
- React
- TypeScript
- CSS Framework: Tailwind CSS V4.x

### 데이터 저장
- **초기 MVP**: LocalStorage 또는 IndexedDB
  - 장점: 백엔드 불필요, 빠른 개발
  - 단점: 브라우저별 용량 제한 (5~10MB), 기기 간 동기화 불가
  - **이미지 첨부 시 용량 관리 필수**: 
    - 이미지 자동 리사이징 (최대 가로 1920px)
    - WebP 형식으로 변환하여 용량 최적화
    - 용량 초과 시 경고 및 오래된 첨부 파일 삭제 제안
  - LocalStorage 용량 제한 시 처리: 경고 메시지 표시 후 오래된 데이터 삭제 제안

- **향후 확장**: 간단한 백엔드 연동 (Superbase)
  - 파일 스토리지 API 활용

### 에러 처리
- 필수 필드 누락 시 입력 폼에서 검증
- LocalStorage 용량 초과 시 경고 및 데이터 Export 유도
- 이미지 업로드 실패 시 재시도 옵션 제공
- 지원하지 않는 파일 형식 업로드 시 경고 메시지
- 파일 크기 초과 시 자동 리사이징 제안
- 네트워크 에러 (향후 백엔드 연동 시): Retry 로직 및 오프라인 모드

---

## 10. MVP에서 제외하는 기능

* 증권사 API 연동
* 실시간 주가/시세 제공
* 자동 수익률 계산
* 알림 기능 (Push Notification)
* 다중 사용자 지원
* 주문/매매 기능
* 차트/그래프 시각화 (선택적으로 Phase 2에서 추가 가능)
* 예수금 히스토리 관리
* OCR을 통한 이미지 텍스트 추출 (향후 검토)
* 첨부 파일 태그/카테고리 분류

---

## 11. 향후 확장 방향 (비구현)

* CSV/엑셀 Import (HTS 잔고 복사 → 붙여넣기)
* 월별 자산 스냅샷 저장
* 간단한 수익률 계산 기능 (평가금액 - 투자금액)
* 증권사 API 연동 가능성 검토
* 다크 모드 지원
* 태그 기능 (섹터별, 테마별 분류)
* 첨부 파일 검색 기능
* PDF 파일 첨부 지원
* OCR을 통한 공시/리포트 자동 텍스트 추출
* 첨부 이미지 내 텍스트 검색
* AI 분석 결과 직접 연동 (API 통합)

---

## 12. 데이터 백업 및 복구

### MVP 범위
* **Export 기능**
  - LocalStorage 전체 데이터를 JSON 파일로 다운로드
  - 파일명 형식: `stock-note-backup-YYYYMMDD.json`

* **Import 기능**
  - JSON 파일 업로드하여 데이터 복구
  - 기존 데이터 덮어쓰기 전 경고 메시지 표시
  - 데이터 유효성 검증 (스키마 체크)

### 목적
- 브라우저 캐시 삭제 또는 기기 변경 시 데이터 손실 방지
- 정기적인 백업 습관 유도 (UI에 "마지막 백업: N일 전" 표시)

---

## 13. 성공 기준 (MVP)

### 정량적 기준 (개인 사용 기준)
- ✅ 최소 3개 이상의 종목에 대해 투자 노트 작성
- ✅ 관심 종목 최소 2개 이상 등록 및 리서치 자료 첨부
- ✅ 노트에 이미지 첨부 최소 5회 이상
- ✅ 1주일에 최소 2회 이상 앱 접속 (2주 연속)
- ✅ 작성한 노트를 최소 1회 이상 다시 조회
- ✅ 종목 추가/수정/삭제가 정상 동작
- ✅ 데이터 Export/Import 1회 이상 성공

### 정성적 기준
- "이번 주말에 자산 정리하려면 이 앱을 켜야지"라는 생각이 듦
- 매도 후 "왜 샀었지?"라는 의문이 들 때 앱에서 답을 찾을 수 있음
- ChatGPT로 분석한 내용을 자연스럽게 앱에 저장하게 됨
- 관심 종목 분석 자료가 쌓여서 매수 시점 판단에 도움이 됨
- HTS보다 투자 판단 관리에 유용하다고 느낌

---

## 14. 개발 환경 목 데이터 시스템

### 14.1 개요

개발 및 테스트 환경에서 다양한 시나리오를 검증하기 위해 **MSW(Mock Service Worker)** 기반의 목 데이터 생성 시스템을 구축한다.

### 14.2 기술 스택

- **MSW (Mock Service Worker)**: API 요청 인터셉트 및 목 데이터 제공
- **Faker.js**: 한국어 로케일 기반 랜덤 데이터 생성
- **LocalStorage**: 목 데이터 영구 저장

### 14.3 목 데이터 구성

#### 한국 주식 종목 샘플
- 삼성전자, SK하이닉스, NAVER, 현대차, LG화학 등 20개 실제 종목
- 종목 코드 및 종목명 포함

#### 증권사 샘플
- 삼성증권, KB증권, 미래에셋증권, NH투자증권, 한국투자증권 등 10개

### 14.4 시나리오 종류

1. **기본 시나리오** (`generateMockData()`)
   - 계좌: 3개
   - 종목: 15개 (다양한 상태 포함)
   - 메모: 20개
   - 첨부파일: 10개

2. **큰 수익 시나리오** (`bigProfit`)
   - 50%~200% 수익률
   - 대량 보유 종목
   - 높은 평가액

3. **손실 시나리오** (`bigLoss`)
   - 10%~50% 손실률
   - 다양한 손실 케이스

4. **소액 투자 시나리오** (`smallPortfolio`)
   - 계좌: 1개
   - 종목: 3개
   - 소액 예수금 (5만원~50만원)

5. **대규모 포트폴리오** (`largePortfolio`)
   - 계좌: 5개
   - 종목: 20개
   - 대량 데이터 및 첨부파일

### 14.5 사용 방법

#### 자동 로드
- 개발 서버 시작 시 localStorage가 비어있으면 자동으로 기본 목 데이터 생성
- MSW 워커가 자동으로 시작되어 API 요청 인터셉트

#### 브라우저 콘솔 명령어

```javascript
// 기본 목 데이터 로드
mockUtils.load()

// 시나리오 변경
mockUtils.loadScenario('bigProfit')      // 큰 수익
mockUtils.loadScenario('bigLoss')        // 손실
mockUtils.loadScenario('smallPortfolio') // 소액 투자
mockUtils.loadScenario('largePortfolio') // 대규모 포트폴리오

// 현재 데이터 확인
mockUtils.getCurrentData()

// MSW 데이터를 localStorage에 저장
mockUtils.save()

// 모든 데이터 삭제
mockUtils.clear()

// 사용 가능한 시나리오 목록
mockUtils.scenarios
```

### 14.6 파일 구조

```
src/
├── mocks/
│   ├── handlers.ts      # MSW API 핸들러
│   └── browser.ts       # MSW 브라우저 워커 설정
├── lib/
│   ├── mockData.ts      # 목 데이터 생성 함수
│   └── devUtils.ts      # 개발 환경 유틸리티
└── main.tsx             # MSW 워커 시작
```

### 14.7 테스트 케이스

목 데이터 시스템을 통해 다음 케이스를 검증한다:

1. **자릿수별 폰트 사이즈 반응형 테스트**
   - 1자리 (0원)
   - 4자리 (1,234원)
   - 7자리 (1,234,567원)
   - 10자리 이상 (12,345,678,901원)

2. **다양한 수익률 케이스**
   - 큰 수익 (+100% 이상)
   - 작은 수익 (+5% 미만)
   - 작은 손실 (-5% 미만)
   - 큰 손실 (-30% 이상)

3. **포트폴리오 규모별 테스트**
   - 소액 투자자 (100만원 미만)
   - 중형 투자자 (1,000만원 ~ 5,000만원)
   - 대형 투자자 (1억원 이상)

4. **데이터 밀도 테스트**
   - 메모가 많은 종목
   - 첨부파일이 많은 메모
   - 계좌가 많은 사용자

---

## 15. 개발 우선순위 및 일정

### Phase 1 (1주차) - 기본 구조
- [ ] 프로젝트 셋업 (React + TypeScript + Tailwind)
- [ ] 데이터 모델 설계 및 LocalStorage 유틸리티 구현
- [ ] 계좌 CRUD (추가/수정/삭제)
- [ ] 종목 CRUD (추가/수정/삭제)
- [ ] 기본 대시보드 (계좌 목록, 종목 목록)

### Phase 2 (2주차) - 핵심 기능
- [ ] 투자 노트 작성/수정/삭제
- [ ] 이미지 첨부 기능 구현 (드래그 앤 드롭, 붙여넣기)
- [ ] 이미지 자동 리사이징 및 WebP 변환
- [ ] 첨부 파일 썸네일 및 라이트박스 뷰어
- [ ] 관심 종목(WATCHLIST) 관리 기능
- [ ] 종목 상세 화면 (노트 리스트 포함)
- [ ] 예수금 입력 및 합산 표시
- [ ] 노트 작성 제안 UX 구현

### Phase 3 (3주차) - 완성도
- [ ] LocalStorage 용량 모니터링 및 경고 시스템
- [ ] UX 개선 (로딩 상태, 에러 메시지, 빈 상태 처리)
- [ ] 데이터 Export/Import 기능 (이미지 포함)
- [ ] 반응형 디자인 최적화
- [ ] 사용자 테스트 및 버그 수정
- [ ] 이미지 용량 최적화 검증

---

## 16. 제약사항 요약

| 항목 | 제약 |
|------|------|
| 계좌명 | 최대 50자 |
| 계좌 개수 | 최대 20개 |
| 종목명 | 최대 50자 |
| 종목코드 | 6자리 (선택) |
| 보유 수량 | 0 ~ 999,999 (WATCHLIST는 0) |
| 평균단가 | 0 ~ 999,999,999원 (WATCHLIST는 0) |
| 예수금 | 0 ~ 999,999,999,999원 |
| 노트 각 필드 | 최대 500자 |
| 계좌 메모 | 최대 200자 |
| 첨부 파일 개수 | 노트당 최대 5개 |
| 이미지 파일 크기 | 최대 5MB/파일 (자동 리사이징) |
| 노트 총 첨부 용량 | 최대 25MB/노트 |
| 지원 이미지 형식 | JPG, PNG, WebP |
| LocalStorage | 약 5~10MB (브라우저별 상이) |

---

## 17. 참고사항

* 이 문서는 MVP 개발을 위한 최소 요구사항을 정의하며, 개발 중 사용자 피드백에 따라 유연하게 조정될 수 있음
* 개발자 본인이 실제 사용자이므로, 개발 과정에서 발견되는 불편함을 즉시 개선할 것을 권장
* "완벽한 제품"보다 "계속 쓰고 싶은 제품"을 목표로 함
---

## 18. 프로세스 및 업무 상세 정의

상세한 입력 프로세스와 개발 워크플로우는 [프로세스 및 업무 상세 정의서](./workflow.md) 문서를 참조한다.
